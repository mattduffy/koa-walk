<script nonce="<%= nonce %>">
  let lat = 0.0
  let lon = 0.0
  if ("geolocation" in navigator) {
    console.log('where are we?') 
    function success(position) {
      console.log(position.coords)
    }
    function error(err) {
      let x
      switch(error.code) {
        case error.PERMISSION_DENIED:
          x = "User denied the request for Geolocation."
          break;
        case error.POSITION_UNAVAILABLE:
          x = "Location information is unavailable."
          break;
        case error.TIMEOUT:
          x = "The request to get user location timed out."
          break;
        case error.UNKNOWN_ERROR:
          x = "An unknown error occurred."
          break;
      } 
      console.info(x)
      console.warn(`${err.code}: ${err.message}`)
    }
    const location = navigator.geolocation.getCurrentPosition(success, error) 
    console.log('location: ', location)
    if (location?.latitude && location?.longitude) {
      lat = location.latitude
      lon = location.longitude
    }
  } else {
    console.log('no way of knowing.')
  }
  if (window.Worker) {
    console.log('Worker <=> Walker')
    const walker = new Worker('<%= origin %>/j/worker.js')
    walker.onmessage = function(e) {
      console.log(`${e.data}`)
    }
    walker.postMessage('What should I do?')
    const tasks = [
      {TASK: 'START_WALK', msg: 'I am starting a walk'},
      {TASK: 'STOP_WALK', msg: 'I am done with my walk'},
      {TASK: 'SET_WAYPOINT', msg: `I am at position (${lat} lat, ${lon} lon).`},
      {TASK: 'SAVE_WALK', msg: 'Save this walk.'},
      {TASK: 'GET_WALK', msg: 'Get that previous walk.'}
    ]
    tasks.forEach(async (walk) => {
      walker.postMessage(walk)
    })
  } else {
    console.log('Not compatible with walking.')
  }
</script>
Take a walk.
